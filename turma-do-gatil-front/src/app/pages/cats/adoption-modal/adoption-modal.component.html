<!-- Modal de Adoção -->
<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="adoption-modal-dialog"
  maskStyleClass="blur-backdrop"
  [style]="{width: '90vw', maxWidth: '600px'}"
  header="Registrar Adoção"
  (onHide)="onHide()">
  
  <form [formGroup]="adoptionForm" (ngSubmit)="onSubmit()" class="adoption-form" *ngIf="cat">
    
    <!-- Informações do Gato -->
    <div class="form-section">
      <h3>
        <i class="fas fa-cat"></i>
        Gato para Adoção
      </h3>
      
      <div class="cat-profile-card">
        <div class="cat-profile-image">
          <img 
            [src]="cat.photoUrl || 'https://images.unsplash.com/photo-1596854407944-bf87f6fdd49e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80'" 
            [alt]="cat.name"
            class="profile-image">
        </div>
        
        <div class="cat-profile-info">
          <h4 class="cat-name">{{ cat.name }}</h4>
          <div class="cat-meta-info">
            <div class="meta-item">
              <i class="fas fa-palette"></i>
              <span>{{ getColorLabel(cat.color) }}</span>
            </div>
            <div class="meta-item">
              <i class="fas" [class.fa-mars]="cat.sex === 'MALE'" [class.fa-venus]="cat.sex === 'FEMALE'"></i>
              <span>{{ cat.sex === 'MALE' ? 'Macho' : 'Fêmea' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p-divider></p-divider>

    <!-- Informações da Adoção -->
    <div class="form-section">
      <h3>
        <i class="fas fa-heart"></i>
        Informações da Adoção
      </h3>
      
      <div class="form-grid">
        <!-- Seleção do Adotante -->
        <div class="form-field form-field-full">
          <label for="adopter">
            <i class="fas fa-user"></i>
            Adotante *
          </label>
          
          <div class="adopter-selection">
            <p-autoComplete
              id="adopter"
              [(ngModel)]="selectedAdopter"
              [suggestions]="filteredAdopters"
              (completeMethod)="searchAdopters($event)"
              (onSelect)="selectAdopter($event)"
              (onClear)="clearSelection()"
              [optionLabel]="getAdopterLabel"
              placeholder="Digite o nome, email ou CPF do adotante..."
              [minLength]="2"
              [class.ng-invalid]="isFieldInvalid('adopter')"
              class="form-input adopter-autocomplete">
              
              <ng-template let-adopter pTemplate="item">
                <div class="adopter-item">
                  <div class="adopter-avatar">
                    <i class="fas fa-user-circle"></i>
                  </div>
                  <div class="adopter-info">
                    <div class="adopter-name">{{ adopter.firstName }} {{ adopter.lastName }}</div>
                    <div class="adopter-contact">{{ adopter.email }} • {{ formatCpf(adopter.cpf) }}</div>
                  </div>
                </div>
              </ng-template>
              
              <ng-template let-adopter pTemplate="selectedItem">
                <div class="selected-adopter-item">
                  <div class="adopter-avatar">
                    <i class="fas fa-user-check"></i>
                  </div>
                  <div class="adopter-info">
                    <div class="adopter-name">{{ adopter.firstName }} {{ adopter.lastName }}</div>
                    <div class="adopter-contact">{{ adopter.email }} • {{ formatCpf(adopter.cpf) }}</div>
                  </div>
                </div>
              </ng-template>
            </p-autoComplete>
            
            <button
              type="button"
              class="create-adopter-button"
              (click)="openCreateAdopterModal()"
              title="Criar novo adotante">
              <i class="pi pi-plus"></i>
              <span class="button-text">Novo Adotante</span>
            </button>
          </div>
          
          <small class="error-message" *ngIf="getFieldError('adopter')">
            {{ getFieldError('adopter') }}
          </small>
        </div>

        <!-- Data da Adoção -->
        <div class="form-field">
          <label for="adoptionDate">Data da Adoção *</label>
          <input
            type="date"
            id="adoptionDate"
            formControlName="adoptionDate"
            class="form-input date-input"
            [class.ng-invalid]="isFieldInvalid('adoptionDate')">
          <small class="error-message" *ngIf="getFieldError('adoptionDate')">
            {{ getFieldError('adoptionDate') }}
          </small>
        </div>

        <!-- Status da Adoção -->
        <div class="form-field">
          <label for="status">Status da Adoção *</label>
          <select
            id="status"
            formControlName="status"
            class="form-input"
            [class.ng-invalid]="isFieldInvalid('status')">
            <option value="">Selecione o status</option>
            <option value="PENDING">Pendente</option>
            <option value="COMPLETED">Concluída</option>
          </select>
          <small class="error-message" *ngIf="getFieldError('status')">
            {{ getFieldError('status') }}
          </small>
        </div>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <div class="action-buttons">
        <app-generic-button 
          [config]="cancelButtonConfig"
          (click)="onHide()">
        </app-generic-button>
        
        <app-generic-button 
          [config]="saveButtonConfig"
          (click)="onSubmit()">
        </app-generic-button>
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Modal de Criação de Adotante -->
<app-adopter-create-modal
  [(visible)]="showCreateAdopterModal"
  (adopterCreated)="onAdopterCreated()">
</app-adopter-create-modal>
