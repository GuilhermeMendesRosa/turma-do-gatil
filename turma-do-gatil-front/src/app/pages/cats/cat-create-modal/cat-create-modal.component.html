<!-- Diálogo de Criação de Gato -->
<p-dialog 
  [(visible)]="visible" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="tdg-modal"
  maskStyleClass="tdg-modal-mask"
  [style]="{width: '90vw', maxWidth: '600px'}"
  [header]="isEditMode ? 'Editar Gato' : 'Adicionar Novo Gato'"
  (onHide)="onHide()">
  
  <form [formGroup]="catForm" class="cat-create-form">
    
    <!-- Upload de Foto -->
    <div class="form-section">
      <h3>
        <i class="fas fa-camera"></i>
        Foto do Gato
      </h3>
      
      <div class="photo-upload-section">
        <div class="photo-preview" *ngIf="previewUrl">
          <img [src]="previewUrl" alt="Preview" class="preview-image">
          <button 
            type="button" 
            class="remove-photo-btn" 
            (click)="onFileRemove()"
            title="Remover foto">
            <i class="fas fa-trash"></i>
          </button>
        </div>
        
        <div class="upload-placeholder" *ngIf="!previewUrl">
          <i class="fas fa-camera upload-icon"></i>
          <p>Clique para adicionar uma foto</p>
          <input 
            type="file" 
            accept="image/*" 
            (change)="onFileSelect($event)"
            class="file-input"
            #fileInput>
          <button 
            type="button" 
            class="upload-btn"
            (click)="fileInput.click()">
            Escolher Arquivo
          </button>
        </div>
        
        <small class="file-info" *ngIf="selectedFile">
          <i class="pi pi-file"></i>
          Arquivo selecionado: {{ selectedFile.name }} ({{ (selectedFile.size / 1024).toFixed(2) }} KB)
        </small>
      </div>
    </div>

    <!-- Informações Básicas -->
    <div class="form-section">
      <h3>
        <i class="fas fa-info-circle"></i>
        Informações Básicas
      </h3>
      
      <div class="form-grid">
        <!-- Nome -->
        <div class="form-field">
          <label for="name">Nome *</label>
          <input 
            pInputText 
            id="name" 
            formControlName="name"
            placeholder="Digite o nome do gato"
            [class.ng-invalid]="isFieldInvalid('name')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('name')">
            {{ getFieldError('name') }}
          </small>
        </div>

        <!-- Cor -->
        <div class="form-field">
          <label for="color">Cor *</label>
          <select 
            id="color"
            formControlName="color"
            [class.ng-invalid]="isFieldInvalid('color')"
            class="form-input form-select">
            <option value="">Selecione a cor</option>
            <option *ngFor="let option of colorOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <small class="error-message" *ngIf="getFieldError('color')">
            {{ getFieldError('color') }}
          </small>
        </div>

        <!-- Sexo -->
        <div class="form-field">
          <label for="sex">Sexo *</label>
          <select 
            id="sex"
            formControlName="sex"
            [class.ng-invalid]="isFieldInvalid('sex')"
            class="form-input form-select">
            <option value="">Selecione o sexo</option>
            <option *ngFor="let option of sexOptions" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
          <small class="error-message" *ngIf="getFieldError('sex')">
            {{ getFieldError('sex') }}
          </small>
        </div>

        <!-- Data de Nascimento -->
        <div class="form-field">
          <label for="birthDate">Data de Nascimento *</label>
          <input 
            type="date" 
            id="birthDate" 
            formControlName="birthDate"
            [class.ng-invalid]="isFieldInvalid('birthDate')"
            class="form-input date-input">
          <small class="error-message" *ngIf="getFieldError('birthDate')">
            {{ getFieldError('birthDate') }}
          </small>
        </div>

        <!-- Data de Entrada no Abrigo -->
        <div class="form-field">
          <label for="shelterEntryDate">Data de Entrada no Abrigo *</label>
          <input 
            type="date" 
            id="shelterEntryDate" 
            formControlName="shelterEntryDate"
            [class.ng-invalid]="isFieldInvalid('shelterEntryDate')"
            class="form-input date-input">
          <small class="error-message" *ngIf="getFieldError('shelterEntryDate')">
            {{ getFieldError('shelterEntryDate') }}
          </small>
        </div>
      </div>
    </div>

    <!-- Informações de Castração -->
    <div class="form-section">
      <h3>
        <i class="fas fa-syringe"></i>
        Castração
      </h3>
      
      <div class="form-grid">
        <!-- Checkbox para indicar se já é castrado -->
        <div class="form-field full-width">
          <div class="checkbox-field">
            <p-checkbox 
              formControlName="alreadySterilized"
              [binary]="true"
              inputId="alreadySterilized">
            </p-checkbox>
            <label for="alreadySterilized" class="checkbox-label">
              Este gato já foi castrado
            </label>
          </div>
        </div>

        <!-- Data da Castração (aparece apenas se marcou como castrado) -->
        <div class="form-field" *ngIf="catForm.get('alreadySterilized')?.value">
          <label for="sterilizationDate">Data da Castração</label>
          <input 
            type="date" 
            id="sterilizationDate" 
            formControlName="sterilizationDate"
            class="form-input date-input"
            placeholder="Informe a data da castração">
          <small class="info-message">
            <i class="pi pi-info-circle"></i>
            Deixe em branco se a data for desconhecida
          </small>
        </div>
      </div>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <small class="upload-info" *ngIf="loading && selectedFile">
        <i class="pi pi-spin pi-spinner"></i>
        Fazendo upload da imagem...
      </small>
      <div class="action-buttons">
        <app-generic-button 
          [config]="cancelButtonConfig"
          (click)="onHide()">
        </app-generic-button>
        
        <app-generic-button 
          [config]="saveButtonConfig"
          (click)="onSubmit()">
        </app-generic-button>
      </div>
    </div>
  </ng-template>
</p-dialog>
