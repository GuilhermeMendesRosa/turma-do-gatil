<div class="page-container">
  <!-- Cabeçalho -->
  <app-page-header
    title="Gestão de Gatos"
    subtitle="Gerencie os gatos disponíveis para adoção no abrigo"
    icon="pi-tag">
  </app-page-header>

  <!-- Estatísticas -->
  <app-stats-grid [stats]="statsData"></app-stats-grid>

  <!-- Filtros -->
  <app-content-card
    title="Filtros de Busca"
    icon="pi-filter"
    [hasActions]="true">
    
    <app-generic-button 
      slot="actions"
      [config]="newCatButtonConfig"
      (click)="openAddCatDialog()">
    </app-generic-button>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label for="nameFilter">
          <i class="pi pi-search"></i>
          Nome do Gato
        </label>
        <input 
          id="nameFilter"
          type="text" 
          pInputText 
          [(ngModel)]="filters.name" 
          (ngModelChange)="onFilterChange()"
          placeholder="Digite o nome do gato..." 
          class="filter-input">
      </div>

      <div class="filter-group">
        <label for="colorFilter">
          <i class="pi pi-palette"></i>
          Cor
        </label>
        <select
          id="colorFilter"
          [(ngModel)]="filters.color"
          (ngModelChange)="onFilterChange()"
          class="filter-select">
          <option [value]="null">Todas as cores</option>
          <option *ngFor="let option of colorOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="sexFilter">
          <i class="pi pi-user"></i>
          Sexo
        </label>
        <select
          id="sexFilter"
          [(ngModel)]="filters.sex"
          (ngModelChange)="onFilterChange()"
          class="filter-select">
          <option [value]="null">Todos os sexos</option>
          <option *ngFor="let option of sexOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="adoptionFilter">
          <i class="pi pi-heart-fill"></i>
          Status
        </label>
        <select
          id="adoptionFilter"
          [(ngModel)]="filters.adoptionStatus"
          (ngModelChange)="onFilterChange()"
          class="filter-select">
          <option [value]="null">Disponíveis para adoção</option>
          <option *ngFor="let option of adoptionStatusOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="sortFilter">
          <i class="pi pi-sort"></i>
          Ordenar por
        </label>
        <select
          id="sortFilter"
          [(ngModel)]="filters.sortBy"
          (ngModelChange)="onSortChange()"
          class="filter-select">
          <option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>

      <div class="filter-actions">
        <app-generic-button 
          [config]="clearFiltersButtonConfig"
          (click)="clearFilters()">
        </app-generic-button>
      </div>
    </div>
  </app-content-card>

  <!-- Loading skeleton -->
  <div class="cats-grid" *ngIf="loadingState.isLoading">
    <div class="cat-card-skeleton" *ngFor="let item of getSkeletonArray(); index as i; trackBy: trackByIndex">
      <div class="skeleton-content">
        <p-skeleton height="200px" class="skeleton-image"></p-skeleton>
        <div class="skeleton-body">
          <p-skeleton height="1.5rem" width="70%" class="skeleton-title"></p-skeleton>
          <p-skeleton height="1rem" width="50%" class="skeleton-text"></p-skeleton>
          <p-skeleton height="1rem" width="40%" class="skeleton-text"></p-skeleton>
          <div class="skeleton-actions">
            <!-- Sem skeleton de botões pois o card é clicável -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de gatos -->
  <div class="cats-grid" *ngIf="!loadingState.isLoading">
    <div class="cat-card" *ngFor="let cat of cats; trackBy: trackByCatId">
      <div class="cat-card-inner clickable-card" (click)="viewCatDetails(cat)">
        <!-- Imagem do gato -->
        <div class="cat-image-container">
          <img 
            [src]="cat.photoUrl || getDefaultImage()" 
            [alt]="cat.name"
            (error)="onImageError($event)"
            class="cat-image">
          
          <!-- Status de adoção -->
          <div class="adoption-status-overlay">
            <div class="adoption-badge" [class]="getAdoptionStatusClass(cat.adoptionStatus)">
              <i class="fas" [class]="getAdoptionStatusIcon(cat.adoptionStatus)"></i>
              <span>{{ getAdoptionStatusText(cat.adoptionStatus) }}</span>
            </div>
          </div>
        </div>

        <!-- Informações do gato -->
        <div class="cat-content">
          <div class="cat-header">
            <h3 class="cat-name">{{ cat.name }}</h3>
            <div class="cat-age">{{ getAge(cat.birthDate) }}</div>
          </div>
          
          <div class="cat-details">
            <div class="detail-row">
              <div class="detail-item">
                <div class="detail-icon color-icon">
                  <i class="fas fa-palette"></i>
                </div>
                <span class="detail-text">{{ getColorLabel(cat.color) }}</span>
              </div>
              
              <div class="detail-item">
                <div class="detail-icon sex-icon">
                  <i class="fas" [class.fa-mars]="cat.sex === 'MALE'" [class.fa-venus]="cat.sex === 'FEMALE'"></i>
                </div>
                <span class="detail-text">{{ getSexLabel(cat.sex) }}</span>
              </div>
            </div>
            
            <div class="detail-item entry-date">
              <div class="detail-icon date-icon">
                <i class="fas fa-calendar-plus"></i>
              </div>
              <span class="detail-text">
                No abrigo desde {{ formatDate(cat.shelterEntryDate) }}
              </span>
            </div>
          </div>

          <!-- Ações do gato -->
          <div class="cat-actions">
            <!-- Card clicável - sem botão Ver Perfil -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensagem quando não há gatos -->
  <div class="empty-state-container" *ngIf="!loadingState.isLoading && cats.length === 0">
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-cat"></i>
      </div>
      <h3>Nenhum gato encontrado</h3>
      <p *ngIf="hasActiveFilters(); else noGatsMessage">
        Não há gatos que correspondam aos filtros selecionados.
        <br>Tente ajustar os filtros ou limpar a busca.
      </p>
      <ng-template #noGatsMessage>
        <p>Ainda não há gatos cadastrados no sistema.</p>
      </ng-template>
      
      <div class="empty-actions">
        <app-generic-button 
          *ngIf="hasActiveFilters()"
          [config]="clearFiltersEmptyButtonConfig"
          (click)="clearFilters()">
        </app-generic-button>
        <app-generic-button 
          [config]="addFirstCatButtonConfig"
          (click)="openAddCatDialog()">
        </app-generic-button>
      </div>
    </div>
  </div>

  <!-- Paginação -->
  <div *ngIf="!loadingState.isLoading && cats.length > 0">
    <app-pagination
      [pagination]="paginationInfo"
      (pageChange)="goToPage({target: {value: $event}})"
      (previousPage)="previousPage()"
      (nextPage)="nextPage()">
    </app-pagination>
  </div>
</div>

<!-- Modal de Detalhes do Gato -->
<app-cat-details-modal
  [(visible)]="catDetailsDialog"
  [cat]="selectedCat"
  (adoptCat)="adoptCat($event)"
  (editCat)="editCat($event)"
  (deleteCat)="deleteCat($event)">
</app-cat-details-modal>

<!-- Modal de Criação/Edição de Gato -->
<app-cat-create-modal
  [(visible)]="catCreateDialog"
  [cat]="catToEdit"
  (catCreated)="onCatCreated()"
  (catUpdated)="onCatUpdated()">
</app-cat-create-modal>

<!-- Dialog de Confirmação de Delete -->
<app-generic-modal 
  [(visible)]="deleteConfirmDialog"
  title="Confirmar Exclusão"
  [dialogStyle]="{width: '450px'}"
  [actions]="deleteModalActions">
  
  <div class="delete-confirm-content">
    <div class="delete-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <div class="delete-message">
      <p>Tem certeza de que deseja excluir o gato <strong>"{{ catToDelete?.name }}"</strong>?</p>
      <p class="delete-warning">Esta ação não pode ser desfeita.</p>
    </div>
  </div>
</app-generic-modal>

<!-- Toast para mensagens -->
<p-toast></p-toast>
