
<!-- 
  Template do componente de gestão de adoções
  
  Estrutura:
  1. Cabeçalho da página com título e descrição
  2. Card de conteúdo com tabela de dados
  3. Paginação integrada
  4. Modal para alteração de status
-->

<div class="page-container">
  <!-- Cabeçalho da página -->
  <app-page-header
    title="Gestão de Adoções"
    subtitle="Acompanhe e gerencie os processos de adoção registrados no sistema"
    icon="pi-heart">
  </app-page-header>

  <!-- Card principal com dados das adoções -->
  <app-content-card
    title="Lista de Adoções"
    icon="pi-list"
    [hasFooter]="totalRecords > 0">
    
    <!-- Indicador de carregamento de dados relacionados -->
    <div *ngIf="loadingRelatedData" class="related-data-loading">
      <i class="pi pi-spinner loading-icon"></i>
      <span>Carregando informações complementares...</span>
    </div>
    
    <!-- Tabela de dados das adoções -->
    <app-data-table
      [columns]="tableColumns"
      [data]="adoptions"
      [loading]="loading"
      [actionProvider]="getRowActions"
      [emptyState]="emptyState"
      [trackByProperty]="'id'"
      (actionClick)="onTableAction($event)">
    </app-data-table>

    <!-- Controles de paginação -->
    <app-pagination 
      slot="footer"
      *ngIf="totalRecords > 0"
      [pagination]="paginationInfo"
      (pageChange)="onPageChange($event)"
      (previousPage)="onPreviousPage()"
      (nextPage)="onNextPage()">
    </app-pagination>

  </app-content-card>
</div>

<!-- Modal para alteração de status da adoção -->
<app-generic-modal
  [(visible)]="showStatusModal"
  [title]="modalConfig.title"
  [actions]="modalActions"
  [dialogStyle]="modalConfig.dialogStyle">
  
  <!-- Conteúdo do modal -->
  <div class="modal-content" [class.modal-loading]="modalLoading">
    
    <!-- Loading overlay para o modal -->
    <div *ngIf="modalLoading" class="modal-loading-overlay">
      <div class="modal-loading-content">
        <i class="pi pi-spinner modal-spinner"></i>
        <span>Atualizando status...</span>
      </div>
    </div>
    
    <!-- Informações da adoção selecionada -->
    <div class="adoption-info-section">
      <div class="field-group">
        <label>Gato:</label>
        <span class="field-value">{{ displayCatName(selectedAdoption?.catId) }}</span>
      </div>
      
      <div class="field-group">
        <label>Adotante:</label>
        <span class="field-value">{{ displayAdopterName(selectedAdoption?.adopterId) }}</span>
      </div>
      
      <div class="field-group">
        <label>Data da Adoção:</label>
        <span class="field-value">{{ displayFormattedDate(selectedAdoption?.adoptionDate) }}</span>
      </div>
    </div>
    
    <!-- Seleção do novo status -->
    <div class="status-selection-section">
      <div class="field-group">
        <label for="status-select">Novo Status:</label>
        <select 
          id="status-select"
          class="status-select"
          [(ngModel)]="selectedStatus"
          [disabled]="modalLoading"
          [attr.aria-label]="'Selecionar novo status para a adoção'">
          
          <option value="" disabled>
            Selecione um status
          </option>
          
          <option 
            *ngFor="let option of statusOptions; trackBy: trackByStatusValue" 
            [value]="option.value">
            {{ option.label }}
          </option>
          
        </select>
      </div>
    </div>
    
    <!-- Upload do termo de adoção (aparece apenas quando status é COMPLETED) -->
    <div class="term-photo-upload-section" *ngIf="selectedStatus === 'COMPLETED'">
      <div class="field-group">
        <label>Termo de Adoção:</label>
        <div class="photo-upload-section">
          <div class="photo-preview" *ngIf="previewUrl">
            <img [src]="previewUrl" alt="Preview do termo" class="preview-image">
            <button 
              type="button" 
              class="remove-photo-btn" 
              (click)="onFileRemove()"
              title="Remover termo">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          
          <div class="upload-placeholder" *ngIf="!previewUrl">
            <i class="fas fa-file-image upload-icon"></i>
            <p>Clique para adicionar o termo de adoção</p>
            <input 
              type="file" 
              accept="image/*" 
              (change)="onFileSelect($event)"
              class="file-input"
              #fileInput>
            <button 
              type="button" 
              class="upload-btn"
              (click)="fileInput.click()">
              Escolher Arquivo
            </button>
          </div>
          
          <small class="file-info" *ngIf="selectedFile">
            <i class="pi pi-file"></i>
            Arquivo selecionado: {{ selectedFile.name }} ({{ (selectedFile.size / 1024).toFixed(2) }} KB)
          </small>
        </div>
      </div>
    </div>

  </div>

</app-generic-modal>
