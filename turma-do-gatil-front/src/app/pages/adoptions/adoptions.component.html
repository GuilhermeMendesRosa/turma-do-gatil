
<!-- 
  Template do componente de gestão de adoções
  
  Estrutura:
  1. Cabeçalho da página com título e descrição
  2. Card de conteúdo com tabela de dados
  3. Paginação integrada
  4. Modal para alteração de status
-->

<div class="page-container">
  <!-- Cabeçalho da página -->
  <app-page-header
    title="Gestão de Adoções"
    subtitle="Acompanhe e gerencie os processos de adoção registrados no sistema"
    icon="pi-heart">
  </app-page-header>

  <!-- Filtros de busca -->
  <app-content-card
    title="Filtros de Busca"
    icon="pi-filter"
    [hasActions]="true">
    
    <button 
      slot="actions"
      class="clear-filters-btn"
      (click)="clearFilters()"
      [disabled]="!filterCatName && !filterAdopterName">
      <i class="pi pi-filter-slash"></i>
      Limpar Filtros
    </button>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label for="catNameFilter">
          <i class="pi pi-tag"></i>
          Nome do Gato
        </label>
        <input 
          id="catNameFilter"
          type="text" 
          [(ngModel)]="filterCatName" 
          (ngModelChange)="onFilterChange()"
          placeholder="Digite o nome do gato..." 
          class="filter-input">
      </div>

      <div class="filter-group">
        <label for="adopterNameFilter">
          <i class="pi pi-user"></i>
          Nome do Adotante
        </label>
        <input 
          id="adopterNameFilter"
          type="text" 
          [(ngModel)]="filterAdopterName" 
          (ngModelChange)="onFilterChange()"
          placeholder="Digite o nome do adotante..." 
          class="filter-input">
      </div>
    </div>
  </app-content-card>

  <!-- Card principal com dados das adoções -->
  <app-content-card
    title="Lista de Adoções"
    icon="pi-list"
    [hasFooter]="totalRecords > 0">
    
    <!-- Indicador de carregamento de dados relacionados -->
    <div *ngIf="loadingRelatedData" class="related-data-loading">
      <i class="pi pi-spinner loading-icon"></i>
      <span>Carregando informações complementares...</span>
    </div>
    
    <!-- Tabela de dados das adoções -->
    <app-data-table
      [columns]="tableColumns"
      [data]="adoptions"
      [loading]="loading"
      [actionProvider]="getRowActions"
      [emptyState]="emptyState"
      [trackByProperty]="'id'"
      (actionClick)="onTableAction($event)"
      (imageClick)="onImageClick($event)">
    </app-data-table>

    <!-- Controles de paginação -->
    <app-pagination 
      slot="footer"
      *ngIf="totalRecords > 0"
      [pagination]="paginationInfo"
      (pageChange)="onPageChange($event)"
      (previousPage)="onPreviousPage()"
      (nextPage)="onNextPage()">
    </app-pagination>

  </app-content-card>
</div>

<!-- Modal para alteração de status da adoção -->
<app-generic-modal
  [(visible)]="showStatusModal"
  [title]="modalConfig.title"
  [actions]="modalActions"
  [dialogStyle]="modalConfig.dialogStyle">
  
  <!-- Conteúdo do modal -->
  <div class="modal-content" [class.modal-loading]="modalLoading">
    
    <!-- Loading overlay para o modal -->
    <div *ngIf="modalLoading" class="modal-loading-overlay">
      <div class="modal-loading-content">
        <i class="pi pi-spinner modal-spinner"></i>
        <span>Atualizando status...</span>
      </div>
    </div>
    
    <!-- Informações da adoção selecionada -->
    <div class="adoption-info-section">
      <div class="field-group">
        <label>Gato:</label>
        <span class="field-value">{{ displayCatName(selectedAdoption?.catId) }}</span>
      </div>
      
      <div class="field-group">
        <label>Adotante:</label>
        <span class="field-value">{{ displayAdopterName(selectedAdoption?.adopterId) }}</span>
      </div>
      
      <div class="field-group">
        <label>Data da Adoção:</label>
        <span class="field-value">{{ displayFormattedDate(selectedAdoption?.adoptionDate) }}</span>
      </div>
    </div>
    
    <!-- Seleção do novo status -->
    <div class="status-selection-section">
      <div class="field-group">
        <label for="status-select">Novo Status:</label>
        <select 
          id="status-select"
          class="status-select"
          [(ngModel)]="selectedStatus"
          [disabled]="modalLoading"
          [attr.aria-label]="'Selecionar novo status para a adoção'">
          
          <option value="" disabled>
            Selecione um status
          </option>
          
          <option 
            *ngFor="let option of statusOptions; trackBy: trackByStatusValue" 
            [value]="option.value">
            {{ option.label }}
          </option>
          
        </select>
      </div>
    </div>
    
    <!-- Upload do termo de adoção (aparece apenas quando status é COMPLETED) -->
    <div class="term-photo-upload-section" *ngIf="selectedStatus === 'COMPLETED'">
      <div class="field-group">
        <label>Termo de Adoção:</label>
        <app-photo-upload
          [previewUrl]="previewUrl"
          [file]="selectedFile"
          placeholder="Clique para adicionar o termo de adoção"
          placeholderIcon="pi-file"
          buttonLabel="Escolher Arquivo"
          removeButtonTitle="Remover termo"
          previewAlt="Preview do termo"
          (fileSelected)="onPhotoFileSelected($event)"
          (fileRemoved)="onFileRemove()">
        </app-photo-upload>
      </div>
    </div>

  </div>

</app-generic-modal>

<!-- Cat Details Modal -->
<app-cat-details-modal
  [(visible)]="catDetailsModalVisible"
  [cat]="selectedCatForDetails"
  (adoptCat)="onAdoptCatFromModal($event)"
  (editCat)="onEditCatFromModal($event)"
  (deleteCat)="onDeleteCatFromModal($event)">
</app-cat-details-modal>
