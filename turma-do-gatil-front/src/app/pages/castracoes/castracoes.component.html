<div class="page-container">
  <app-page-header
    title="Castrações"
    subtitle="Gerencie e acompanhe o programa de castrações dos gatos."
    icon="pi-briefcase">
  </app-page-header>
  
  <!-- Cards de Estatísticas -->
  <app-stats-grid [stats]="getStatsData()"></app-stats-grid>

  <!-- Tabela de Gatos que Precisam de Castração -->
  <app-content-card
    title="Gatos que Precisam de Castração"
    icon="pi-heart"
    [hasActions]="true">
    
    <div slot="actions">
      <app-refresh-button 
        [loading]="loadingCats"
        (refresh)="refreshData()">
      </app-refresh-button>
    </div>
    
    <div *ngIf="!loadingCats; else loadingTemplate">
      <app-data-table
        [columns]="catsTableColumns"
        [data]="catsNeedingSterilization"
        [loading]="loadingCats"
        [emptyState]="catsEmptyState"
        [actionProvider]="getCatsTableActions"
        trackByProperty="id"
        (actionClick)="onCatsTableAction($event)">
      </app-data-table>
    </div>
  </app-content-card>

  <!-- Tabela de Castrações Agendadas -->
  <app-content-card
    title="Castrações Agendadas"
    icon="pi-calendar"
    [hasActions]="true"
    [hasFooter]="true">
    
    <div slot="actions">
      <app-refresh-button 
        [loading]="loadingSterilizations"
        (refresh)="loadScheduledSterilizations()">
      </app-refresh-button>
    </div>
    
    <div *ngIf="!loadingSterilizations; else loadingTemplate">
      <app-data-table
        [columns]="scheduledTableColumns"
        [data]="scheduledSterilizations"
        [loading]="loadingSterilizations"
        [emptyState]="scheduledEmptyState"
        [actionProvider]="getScheduledTableActions"
        trackByProperty="id"
        (actionClick)="onScheduledTableAction($event)">
      </app-data-table>
    </div>

    <!-- Paginação para castrações agendadas -->
    <div slot="footer">
      <app-pagination
        [pagination]="getScheduledPaginationInfo()"
        (pageChange)="goToPage({target: {value: $event}})"
        (previousPage)="previousPage()"
        (nextPage)="nextPage()">
      </app-pagination>
    </div>
  </app-content-card>

  <!-- Tabela de Castrações Realizadas -->
  <app-content-card
    title="Castrações Realizadas"
    icon="pi-check-circle"
    [hasActions]="true"
    [hasFooter]="true">
    
    <div slot="actions">
      <app-refresh-button 
        [loading]="loadingCompletedSterilizations"
        (refresh)="loadCompletedSterilizations()">
      </app-refresh-button>
    </div>
    
    <div *ngIf="!loadingCompletedSterilizations; else loadingTemplate">
      <app-data-table
        [columns]="completedTableColumns"
        [data]="completedSterilizations"
        [loading]="loadingCompletedSterilizations"
        [emptyState]="completedEmptyState"
        trackByProperty="id">
      </app-data-table>
    </div>

    <!-- Paginação para castrações realizadas -->
    <div slot="footer">
      <app-pagination
        [pagination]="getCompletedPaginationInfo()"
        (pageChange)="goToCompletedPage({target: {value: $event}})"
        (previousPage)="previousCompletedPage()"
        (nextPage)="nextCompletedPage()">
      </app-pagination>
    </div>
  </app-content-card>

  <ng-template #loadingTemplate>
    <div class="loading-message">
      <i class="pi pi-spinner"></i>
      Carregando...
    </div>
  </ng-template>
</div>

<!-- Modal de Agendamento/Edição de Castração -->
<app-sterilization-schedule-modal
  [(visible)]="scheduleModalVisible"
  [cat]="selectedCatForSchedule"
  [sterilization]="selectedSterilizationForEdit"
  (sterilizationScheduled)="onSterilizationScheduled()"
  (sterilizationUpdated)="onSterilizationUpdated()"
  (visibleChange)="onScheduleModalHide()">
</app-sterilization-schedule-modal>
