<div class="page-container">
  <!-- Cabeçalho -->
  <div class="page-header">
    <h1 class="page-title">
      <i class="fas fa-cat"></i>
      Gestão de Gatos
    </h1>
    <p class="page-subtitle">Gerencie os gatos disponíveis para adoção no abrigo</p>
  </div>

  <!-- Estatísticas -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon available">
        <i class="fas fa-heart"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getAvailableCatsCount() }}</h3>
        <p>Disponíveis</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon adopted">
        <i class="fas fa-home"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getAdoptedCatsCount() }}</h3>
        <p>Adotados</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="fas fa-cat"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalRecords }}</h3>
        <p>Total</p>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-card">
      <div class="filters-header">
        <h3>
          <i class="fas fa-filter"></i>
          Filtros de Busca
        </h3>
        <p-button 
          label="Novo Gato" 
          icon="pi pi-plus" 
          (onClick)="openAddCatDialog()"
          size="small">
        </p-button>
      </div>
      
      <div class="filters-grid">
        <div class="filter-group">
          <label for="nameFilter">
            <i class="pi pi-search"></i>
            Nome do Gato
          </label>
          <input 
            id="nameFilter"
            type="text" 
            pInputText 
            [(ngModel)]="filters.name" 
            (ngModelChange)="onFilterChange()"
            placeholder="Digite o nome do gato..." 
            class="filter-input">
        </div>

        <div class="filter-group">
          <label for="colorFilter">
            <i class="pi pi-palette"></i>
            Cor
          </label>
          <p-select
            id="colorFilter"
            [(ngModel)]="filters.color"
            (ngModelChange)="onFilterChange()"
            [options]="colorOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Todas as cores"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="sexFilter">
            <i class="pi pi-user"></i>
            Sexo
          </label>
          <p-select
            id="sexFilter"
            [(ngModel)]="filters.sex"
            (ngModelChange)="onFilterChange()"
            [options]="sexOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Todos os sexos"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="adoptionFilter">
            <i class="pi pi-heart-fill"></i>
            Status
          </label>
          <p-select
            id="adoptionFilter"
            [(ngModel)]="filters.adoptionStatus"
            (ngModelChange)="onFilterChange()"
            [options]="adoptionStatusOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Disponíveis para adoção"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="sortFilter">
            <i class="pi pi-sort"></i>
            Ordenar por
          </label>
          <p-select
            id="sortFilter"
            [(ngModel)]="filters.sortBy"
            (ngModelChange)="onSortChange()"
            [options]="sortOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Ordenação"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-actions">
          <p-button 
            label="Limpar" 
            icon="pi pi-filter-slash" 
            (onClick)="clearFilters()"
            [outlined]="true"
            severity="secondary"
            size="small">
          </p-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading skeleton -->
  <div class="cats-grid" *ngIf="loading">
    <div class="cat-card-skeleton" *ngFor="let item of [1,2,3,4,5,6,7,8,9,10,11,12]">
      <div class="skeleton-content">
        <p-skeleton height="200px" class="skeleton-image"></p-skeleton>
        <div class="skeleton-body">
          <p-skeleton height="1.5rem" width="70%" class="skeleton-title"></p-skeleton>
          <p-skeleton height="1rem" width="50%" class="skeleton-text"></p-skeleton>
          <p-skeleton height="1rem" width="40%" class="skeleton-text"></p-skeleton>
          <div class="skeleton-actions">
            <!-- Sem skeleton de botões pois o card é clicável -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de gatos -->
  <div class="cats-grid" *ngIf="!loading">
    <div class="cat-card" *ngFor="let cat of cats; trackBy: trackByCatId">
      <div class="cat-card-inner clickable-card" (click)="viewCatDetails(cat)" pTooltip="Clique para ver o perfil completo">
        <!-- Imagem do gato -->
        <div class="cat-image-container">
          <img 
            [src]="cat.photoUrl || getDefaultImage()" 
            [alt]="cat.name"
            (error)="onImageError($event)"
            class="cat-image">
          
          <!-- Status de adoção -->
          <div class="adoption-status-overlay">
            <div class="adoption-badge" [class]="getAdoptionStatusClass(cat.adoptionStatus)">
              <i class="fas" [class]="getAdoptionStatusIcon(cat.adoptionStatus)"></i>
              <span>{{ getAdoptionStatusText(cat.adoptionStatus) }}</span>
            </div>
          </div>
        </div>

        <!-- Informações do gato -->
        <div class="cat-content">
          <div class="cat-header">
            <h3 class="cat-name">{{ cat.name }}</h3>
            <div class="cat-age">{{ getAge(cat.birthDate) }}</div>
          </div>
          
          <div class="cat-details">
            <div class="detail-row">
              <div class="detail-item">
                <div class="detail-icon color-icon">
                  <i class="fas fa-palette"></i>
                </div>
                <span class="detail-text">{{ getColorLabel(cat.color) }}</span>
              </div>
              
              <div class="detail-item">
                <div class="detail-icon sex-icon">
                  <i class="fas" [class.fa-mars]="cat.sex === 'MALE'" [class.fa-venus]="cat.sex === 'FEMALE'"></i>
                </div>
                <span class="detail-text">{{ getSexLabel(cat.sex) }}</span>
              </div>
            </div>
            
            <div class="detail-item entry-date">
              <div class="detail-icon date-icon">
                <i class="fas fa-calendar-plus"></i>
              </div>
              <span class="detail-text">
                No abrigo desde {{ formatDate(cat.shelterEntryDate) }}
              </span>
            </div>
          </div>

          <!-- Ações do gato -->
          <div class="cat-actions">
            <!-- Card clicável - sem botão Ver Perfil -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensagem quando não há gatos -->
  <div class="empty-state-container" *ngIf="!loading && cats.length === 0">
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-cat"></i>
      </div>
      <h3>Nenhum gato encontrado</h3>
      <p *ngIf="hasActiveFilters(); else noGatsMessage">
        Não há gatos que correspondam aos filtros selecionados.
        <br>Tente ajustar os filtros ou limpar a busca.
      </p>
      <ng-template #noGatsMessage>
        <p>Ainda não há gatos cadastrados no sistema.</p>
      </ng-template>
      
      <div class="empty-actions">
        <p-button 
          *ngIf="hasActiveFilters()"
          label="Limpar Filtros" 
          icon="pi pi-filter-slash" 
          (onClick)="clearFilters()"
          [outlined]="true">
        </p-button>
        <p-button 
          label="Cadastrar Primeiro Gato" 
          icon="pi pi-plus" 
          (onClick)="openAddCatDialog()">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Resultados e Paginação -->
  <div class="results-section" *ngIf="!loading && cats.length > 0">
    <div class="results-info">
      <span class="results-text">
        Mostrando {{ (currentPage * pageSize) + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalRecords) }} 
        de {{ totalRecords }} gatos
      </span>
      
      <div class="page-size-selector">
        <label>Itens por página:</label>
        <p-select
          [(ngModel)]="pageSize"
          (ngModelChange)="onPageSizeChange()"
          [options]="pageSizeOptions"
          optionLabel="label"
          optionValue="value">
        </p-select>
      </div>
    </div>

    <!-- Paginação -->
    <div class="pagination-container" *ngIf="totalRecords > pageSize">
      <p-paginator
        [rows]="pageSize"
        [totalRecords]="totalRecords"
        [first]="currentPage * pageSize"
        (onPageChange)="onPageChange($event)"
        [showCurrentPageReport]="true"
        [showJumpToPageDropdown]="true"
        [showPageLinks]="true"
        [pageLinkSize]="5"
        currentPageReportTemplate="Página {currentPage} de {totalPages}">
      </p-paginator>
    </div>
  </div>
</div>

<!-- Modal de Detalhes do Gato -->
<app-cat-details-modal
  [(visible)]="catDetailsDialog"
  [cat]="selectedCat"
  (adoptCat)="adoptCat($event)"
  (editCat)="editCat($event)"
  (deleteCat)="deleteCat($event)">
</app-cat-details-modal>

<!-- Modal de Criação/Edição de Gato -->
<app-cat-create-modal
  [(visible)]="catCreateDialog"
  [cat]="catToEdit"
  (catCreated)="onCatCreated()"
  (catUpdated)="onCatUpdated()">
</app-cat-create-modal>

<!-- Dialog de Confirmação de Delete -->
<p-dialog 
  [(visible)]="deleteConfirmDialog" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="delete-confirm-dialog"
  [style]="{width: '450px'}"
  header="Confirmar Exclusão">
  
  <div class="delete-confirm-content">
    <div class="delete-icon">
      <i class="fas fa-exclamation-triangle"></i>
    </div>
    <div class="delete-message">
      <p>Tem certeza de que deseja excluir o gato <strong>"{{ catToDelete?.name }}"</strong>?</p>
      <p class="delete-warning">Esta ação não pode ser desfeita.</p>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="delete-dialog-footer">
      <p-button 
        label="Cancelar" 
        icon="pi pi-times" 
        severity="secondary"
        [outlined]="true"
        (onClick)="cancelDelete()">
      </p-button>
      <p-button 
        label="Sim, excluir" 
        icon="pi pi-trash" 
        severity="danger"
        (onClick)="confirmDelete()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- Toast para mensagens -->
<p-toast></p-toast>
