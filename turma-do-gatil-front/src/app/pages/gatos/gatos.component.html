<div class="page-container">
  <!-- Cabeçalho -->
  <div class="page-header">
    <h1 class="page-title">
      <i class="fas fa-cat"></i>
      Gestão de Gatos
    </h1>
    <p class="page-subtitle">Gerencie os gatos disponíveis para adoção no abrigo</p>
  </div>

  <!-- Estatísticas -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-icon available">
        <i class="fas fa-heart"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getAvailableCatsCount() }}</h3>
        <p>Disponíveis</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon adopted">
        <i class="fas fa-home"></i>
      </div>
      <div class="stat-content">
        <h3>{{ getAdoptedCatsCount() }}</h3>
        <p>Adotados</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon total">
        <i class="fas fa-cat"></i>
      </div>
      <div class="stat-content">
        <h3>{{ totalRecords }}</h3>
        <p>Total</p>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-card">
      <div class="filters-header">
        <h3>
          <i class="fas fa-filter"></i>
          Filtros de Busca
        </h3>
        <p-button 
          label="Novo Gato" 
          icon="pi pi-plus" 
          (onClick)="openAddCatDialog()"
          severity="success"
          size="small">
        </p-button>
      </div>
      
      <div class="filters-grid">
        <div class="filter-group">
          <label for="nameFilter">
            <i class="pi pi-search"></i>
            Nome do Gato
          </label>
          <input 
            id="nameFilter"
            type="text" 
            pInputText 
            [(ngModel)]="filters.name" 
            (ngModelChange)="onFilterChange()"
            placeholder="Digite o nome do gato..." 
            class="filter-input">
        </div>

        <div class="filter-group">
          <label for="colorFilter">
            <i class="pi pi-palette"></i>
            Cor
          </label>
          <p-select
            id="colorFilter"
            [(ngModel)]="filters.color"
            (ngModelChange)="onFilterChange()"
            [options]="colorOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Todas as cores"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="sexFilter">
            <i class="pi pi-user"></i>
            Sexo
          </label>
          <p-select
            id="sexFilter"
            [(ngModel)]="filters.sex"
            (ngModelChange)="onFilterChange()"
            [options]="sexOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Todos os sexos"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="adoptionFilter">
            <i class="pi pi-heart-fill"></i>
            Status
          </label>
          <p-select
            id="adoptionFilter"
            [(ngModel)]="filters.adopted"
            (ngModelChange)="onFilterChange()"
            [options]="adoptionStatusOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Disponíveis para adoção"
            [showClear]="true"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-group">
          <label for="sortFilter">
            <i class="pi pi-sort"></i>
            Ordenar por
          </label>
          <p-select
            id="sortFilter"
            [(ngModel)]="filters.sortBy"
            (ngModelChange)="onSortChange()"
            [options]="sortOptions"
            optionLabel="label"
            optionValue="value"
            placeholder="Ordenação"
            class="filter-select custom-select">
          </p-select>
        </div>

        <div class="filter-actions">
          <p-button 
            label="Limpar" 
            icon="pi pi-filter-slash" 
            (onClick)="clearFilters()"
            [outlined]="true"
            severity="secondary"
            size="small">
          </p-button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading skeleton -->
  <div class="cats-grid" *ngIf="loading">
    <div class="cat-card-skeleton" *ngFor="let item of [1,2,3,4,5,6,7,8,9,10,11,12]">
      <div class="skeleton-content">
        <p-skeleton height="200px" class="skeleton-image"></p-skeleton>
        <div class="skeleton-body">
          <p-skeleton height="1.5rem" width="70%" class="skeleton-title"></p-skeleton>
          <p-skeleton height="1rem" width="50%" class="skeleton-text"></p-skeleton>
          <p-skeleton height="1rem" width="40%" class="skeleton-text"></p-skeleton>
          <div class="skeleton-actions">
            <!-- Sem skeleton de botões pois o card é clicável -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Grid de gatos -->
  <div class="cats-grid" *ngIf="!loading">
    <div class="cat-card" *ngFor="let cat of cats; trackBy: trackByCatId">
      <div class="cat-card-inner clickable-card" (click)="viewCatDetails(cat)" pTooltip="Clique para ver o perfil completo">
        <!-- Imagem do gato -->
        <div class="cat-image-container">
          <img 
            [src]="cat.photoUrl || getDefaultImage()" 
            [alt]="cat.name"
            (error)="onImageError($event)"
            class="cat-image">
          
          <!-- Status de adoção -->
          <div class="adoption-status-overlay">
            <div class="adoption-badge" [class.adopted]="cat.adopted">
              <i class="fas" [class.fa-heart]="!cat.adopted" [class.fa-home]="cat.adopted"></i>
              <span>{{ cat.adopted ? 'Adotado' : 'Disponível' }}</span>
            </div>
          </div>

          <!-- Ícone de favorito -->
          <div class="favorite-icon">
            <i class="fas fa-heart" [class.favorited]="cat.adopted"></i>
          </div>
        </div>

        <!-- Informações do gato -->
        <div class="cat-content">
          <div class="cat-header">
            <h3 class="cat-name">{{ cat.name }}</h3>
            <div class="cat-age">{{ getAge(cat.birthDate) }}</div>
          </div>
          
          <div class="cat-details">
            <div class="detail-row">
              <div class="detail-item">
                <div class="detail-icon color-icon">
                  <i class="fas fa-palette"></i>
                </div>
                <span class="detail-text">{{ getColorLabel(cat.color) }}</span>
              </div>
              
              <div class="detail-item">
                <div class="detail-icon sex-icon">
                  <i class="fas" [class.fa-mars]="cat.sex === 'MALE'" [class.fa-venus]="cat.sex === 'FEMALE'"></i>
                </div>
                <span class="detail-text">{{ getSexLabel(cat.sex) }}</span>
              </div>
            </div>
            
            <div class="detail-item entry-date">
              <div class="detail-icon date-icon">
                <i class="fas fa-calendar-plus"></i>
              </div>
              <span class="detail-text">
                No abrigo desde {{ formatDate(cat.shelterEntryDate) }}
              </span>
            </div>
          </div>

          <!-- Ações do gato -->
          <div class="cat-actions">
            <!-- Card clicável - sem botão Ver Perfil -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensagem quando não há gatos -->
  <div class="empty-state-container" *ngIf="!loading && cats.length === 0">
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-cat"></i>
      </div>
      <h3>Nenhum gato encontrado</h3>
      <p *ngIf="hasActiveFilters(); else noGatsMessage">
        Não há gatos que correspondam aos filtros selecionados.
        <br>Tente ajustar os filtros ou limpar a busca.
      </p>
      <ng-template #noGatsMessage>
        <p>Ainda não há gatos cadastrados no sistema.</p>
      </ng-template>
      
      <div class="empty-actions">
        <p-button 
          *ngIf="hasActiveFilters()"
          label="Limpar Filtros" 
          icon="pi pi-filter-slash" 
          (onClick)="clearFilters()"
          [outlined]="true">
        </p-button>
        <p-button 
          label="Cadastrar Primeiro Gato" 
          icon="pi pi-plus" 
          (onClick)="openAddCatDialog()"
          severity="success">
        </p-button>
      </div>
    </div>
  </div>

  <!-- Resultados e Paginação -->
  <div class="results-section" *ngIf="!loading && cats.length > 0">
    <div class="results-info">
      <span class="results-text">
        Mostrando {{ (currentPage * pageSize) + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalRecords) }} 
        de {{ totalRecords }} gatos
      </span>
      
      <div class="page-size-selector">
        <label>Itens por página:</label>
        <p-select
          [(ngModel)]="pageSize"
          (ngModelChange)="onPageSizeChange()"
          [options]="pageSizeOptions"
          optionLabel="label"
          optionValue="value">
        </p-select>
      </div>
    </div>

    <!-- Paginação -->
    <div class="pagination-container" *ngIf="totalRecords > pageSize">
      <p-paginator
        [rows]="pageSize"
        [totalRecords]="totalRecords"
        [first]="currentPage * pageSize"
        (onPageChange)="onPageChange($event)"
        [showCurrentPageReport]="true"
        [showJumpToPageDropdown]="true"
        [showPageLinks]="true"
        [pageLinkSize]="5"
        currentPageReportTemplate="Página {currentPage} de {totalPages}">
      </p-paginator>
    </div>
  </div>
</div>

<!-- Diálogo de Detalhes do Gato -->
<p-dialog 
  [(visible)]="catDetailsDialog" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="cat-details-dialog"
  maskStyleClass="blur-backdrop"
  [style]="{width: '90vw', maxWidth: '800px'}"
  header="Perfil do Gato"
  (onHide)="closeCatDetailsDialog()">
  
  <div class="cat-profile-container" *ngIf="selectedCat">
    <!-- Cabeçalho do perfil -->
    <div class="cat-profile-header">
      <div class="cat-profile-image">
        <img 
          [src]="selectedCat.photoUrl || getDefaultImage()" 
          [alt]="selectedCat.name"
          (error)="onImageError($event)"
          class="profile-image">
        
        <!-- Status de adoção -->
        <div class="profile-status">
          <div class="status-badge" [class.adopted]="selectedCat.adopted">
            <i class="fas" [class.fa-heart]="!selectedCat.adopted" [class.fa-home]="selectedCat.adopted"></i>
            <span>{{ selectedCat.adopted ? 'Adotado' : 'Disponível para Adoção' }}</span>
          </div>
        </div>
      </div>
      
      <div class="cat-profile-info">
        <h2 class="cat-profile-name">{{ selectedCat.name }}</h2>
        <div class="cat-profile-age">{{ getAge(selectedCat.birthDate) }}</div>
        
        <div class="quick-info">
          <div class="quick-info-item">
            <i class="fas fa-palette"></i>
            <span>{{ getColorLabel(selectedCat.color) }}</span>
          </div>
          <div class="quick-info-item">
            <i class="fas" [class.fa-mars]="selectedCat.sex === 'MALE'" [class.fa-venus]="selectedCat.sex === 'FEMALE'"></i>
            <span>{{ getSexLabel(selectedCat.sex) }}</span>
          </div>
        </div>
      </div>
    </div>

    <p-divider></p-divider>

    <!-- Informações detalhadas -->
    <div class="cat-profile-details">
      <h3>
        <i class="fas fa-info-circle"></i>
        Informações Detalhadas
      </h3>
      
      <div class="details-grid">
        <div class="detail-card">
          <div class="detail-label">
            <i class="fas fa-birthday-cake"></i>
            Data de Nascimento
          </div>
          <div class="detail-value">{{ formatDate(selectedCat.birthDate) }}</div>
        </div>

        <div class="detail-card">
          <div class="detail-label">
            <i class="fas fa-calendar-plus"></i>
            Entrada no Abrigo
          </div>
          <div class="detail-value">{{ formatDate(selectedCat.shelterEntryDate) }}</div>
        </div>

        <div class="detail-card">
          <div class="detail-label">
            <i class="fas fa-clock"></i>
            Tempo no Abrigo
          </div>
          <div class="detail-value">{{ getDaysInShelter(selectedCat.shelterEntryDate) }} dias</div>
        </div>

        <div class="detail-card">
          <div class="detail-label">
            <i class="fas fa-palette"></i>
            Cor
          </div>
          <div class="detail-value">{{ getColorLabel(selectedCat.color) }}</div>
        </div>

        <div class="detail-card">
          <div class="detail-label">
            <i class="fas" [class.fa-mars]="selectedCat.sex === 'MALE'" [class.fa-venus]="selectedCat.sex === 'FEMALE'"></i>
            Sexo
          </div>
          <div class="detail-value">{{ getSexLabel(selectedCat.sex) }}</div>
        </div>

        <div class="detail-card">
          <div class="detail-label">
            <i class="fas fa-heart"></i>
            Status de Adoção
          </div>
          <div class="detail-value">
            <p-tag 
              [value]="selectedCat.adopted ? 'Adotado' : 'Disponível'" 
              [severity]="selectedCat.adopted ? 'success' : 'info'">
            </p-tag>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="dialog-footer">
      <div class="action-buttons">
        <p-button 
          *ngIf="!selectedCat?.adopted"
          label="Adotar" 
          icon="pi pi-heart" 
          severity="success"
          (onClick)="adoptCat(selectedCat!)"
          pTooltip="Registrar adoção do gato">
        </p-button>
        
        <p-button 
          label="Editar" 
          icon="pi pi-pencil" 
          severity="secondary"
          (onClick)="editCat(selectedCat!)"
          pTooltip="Editar informações do gato">
        </p-button>
        
        <p-button 
          label="Deletar" 
          icon="pi pi-trash" 
          severity="danger"
          [outlined]="true"
          (onClick)="deleteCat(selectedCat!)"
          pTooltip="Remover gato do sistema">
        </p-button>
      </div>
    </div>
  </ng-template>
</p-dialog>
