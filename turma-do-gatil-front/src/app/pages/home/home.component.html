<div class="page-container">
  <div class="header">
    <h1><i class="pi pi-chart-bar"></i> Dashboard</h1>
    <button class="refresh-btn" (click)="refreshData()" [disabled]="loading" title="Atualizar dados">
      <i class="pi" [class.pi-refresh]="!loading" [class.pi-spin]="loading" [class.pi-spinner]="loading"></i>
    </button>
  </div>

  <p>Bem-vindo ao sistema de gerenciamento da Turma do Gatil!</p>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <i class="pi pi-spinner pi-spin"></i>
    <span>Carregando dados...</span>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <i class="pi pi-exclamation-triangle"></i>
    <span>{{ error }}</span>
    <button class="retry-btn" (click)="refreshData()">
      <i class="pi pi-refresh"></i>
      Tentar novamente
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="dashboardData && !loading" class="dashboard-content">
    <!-- Summary Cards -->
    <div class="dashboard-grid">
      <div class="dashboard-card">
        <div class="card-header">
          <i class="pi pi-heart"></i>
          <h3>Gatos</h3>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="number">{{ dashboardData.availableCats.length }}</span>
            <span class="label">Disponíveis para adoção</span>
          </div>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-header">
          <i class="pi pi-briefcase"></i>
          <h3>Castrações</h3>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="number">{{ dashboardData.pendingSterilizations.length }}</span>
            <span class="label">Agendadas</span>
          </div>
        </div>
      </div>

      <div class="dashboard-card">
        <div class="card-header">
          <i class="pi pi-users"></i>
          <h3>Adotantes</h3>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="number">{{ dashboardData.registeredAdopters.length }}</span>
            <span class="label">Cadastrados recentemente</span>
          </div>
        </div>
      </div>

      <div class="dashboard-card clickable" routerLink="/cats">
        <div class="card-header">
          <i class="pi pi-eye"></i>
          <h3>Ver Todos</h3>
        </div>
        <div class="card-content">
          <div class="metric">
            <span class="action-text">Gerenciar</span>
            <span class="label">Gatos, Adoções e Castrações</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Details Sections -->
    <div class="details-grid">
      <!-- Available Cats -->
      <div class="detail-section">
        <h2><i class="pi pi-heart"></i> Gatos Disponíveis</h2>
        <div *ngIf="dashboardData.availableCats.length === 0" class="empty-state">
          <i class="pi pi-info-circle"></i>
          <span>Nenhum gato disponível para adoção no momento.</span>
        </div>
        <div *ngIf="dashboardData.availableCats.length > 0" class="items-grid">
          <div *ngFor="let cat of dashboardData.availableCats" class="item-card">
            <div class="item-image">
              <img *ngIf="cat.photoUrl" [src]="cat.photoUrl" [alt]="cat.name">
              <div *ngIf="!cat.photoUrl" class="no-image">
                <i class="pi pi-image"></i>
              </div>
            </div>
            <div class="item-content">
              <h4>{{ cat.name }}</h4>
              <p><strong>Cor:</strong> {{ getColorDisplayName(cat.color) }}</p>
              <p><strong>Sexo:</strong> {{ getSexDisplayName(cat.sex) }}</p>
              <p><strong>Entrada:</strong> {{ formatDate(cat.shelterEntryDate) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Sterilizations -->
      <div class="detail-section">
        <h2><i class="pi pi-briefcase"></i> Castrações Agendadas</h2>
        <div *ngIf="dashboardData.pendingSterilizations.length === 0" class="empty-state">
          <i class="pi pi-info-circle"></i>
          <span>Nenhuma castração agendada no momento.</span>
        </div>
        <div *ngIf="dashboardData.pendingSterilizations.length > 0" class="items-list">
          <div *ngFor="let sterilization of dashboardData.pendingSterilizations" class="list-item">
            <div class="list-image">
              <img *ngIf="sterilization.photoUrl" [src]="sterilization.photoUrl" [alt]="sterilization.cat">
              <div *ngIf="!sterilization.photoUrl" class="no-image-small">
                <i class="pi pi-image"></i>
              </div>
            </div>
            <div class="list-content">
              <h4>{{ sterilization.cat }}</h4>
              <p><strong>Data:</strong> {{ formatDate(sterilization.sterilizationDate) }}</p>
              <p><strong>Status:</strong> {{ getStatusDisplayName(sterilization.status) }}</p>
              <p *ngIf="sterilization.notes"><strong>Obs:</strong> {{ sterilization.notes }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Adopters -->
      <div class="detail-section">
        <h2><i class="pi pi-users"></i> Adotantes Recentes</h2>
        <div *ngIf="dashboardData.registeredAdopters.length === 0" class="empty-state">
          <i class="pi pi-info-circle"></i>
          <span>Nenhum adotante cadastrado recentemente.</span>
        </div>
        <div *ngIf="dashboardData.registeredAdopters.length > 0" class="items-list">
          <div *ngFor="let adopter of dashboardData.registeredAdopters" class="list-item">
            <div class="list-avatar">
              <i class="pi pi-user"></i>
            </div>
            <div class="list-content">
              <h4>{{ adopter.firstName }} {{ adopter.lastName }}</h4>
              <p><strong>Email:</strong> {{ adopter.email }}</p>
              <p><strong>Telefone:</strong> {{ adopter.phone }}</p>
              <p><strong>Cadastro:</strong> {{ formatDate(adopter.registrationDate) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>