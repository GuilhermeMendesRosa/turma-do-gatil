<div class="page-container">
  <!-- ==================== CABEÇALHO DA PÁGINA ==================== -->
  <app-page-header
    title="Gestão de Adotantes"
    subtitle="Gerencie as informações dos adotantes cadastrados no sistema"
    icon="pi-users">
  </app-page-header>

  <!-- ==================== SEÇÃO DE FILTROS ==================== -->
  <app-content-card
    title="Filtros de Busca"
    icon="pi-filter"
    [hasActions]="true">
    
    <div slot="actions">
      <app-modal-button 
        [config]="getNewAdopterButtonConfig()">
      </app-modal-button>
    </div>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label for="nameFilter">
          <i class="pi pi-search"></i>
          Nome do Adotante
        </label>
        <input 
          id="nameFilter"
          type="text" 
          pInputText 
          [(ngModel)]="filters.name" 
          (ngModelChange)="onFilterChange()"
          placeholder="Digite o nome..."
          class="filter-input">
      </div>
    </div>
  </app-content-card>
  
  <!-- ==================== TABELA DE ADOTANTES ==================== -->
  <app-content-card
    title="Lista de Adotantes"
    icon="pi-list"
    [hasActions]="true"
    [hasFooter]="true">
    
    <div slot="actions">
      <app-refresh-button 
        [loading]="loading"
        (refresh)="loadAdopters()">
      </app-refresh-button>
    </div>

    <!-- Conteúdo da tabela -->
    <app-loading-state [loading]="loading" message="Carregando adotantes...">
      <app-data-table
        [columns]="adoptersTableColumns"
        [data]="adopters"
        [loading]="loading"
        [emptyState]="emptyState"
        [actionProvider]="getAdopterActions"
        trackByProperty="id"
        (actionClick)="onAdopterTableAction($event)">
      </app-data-table>
    </app-loading-state>

    <!-- Paginação -->
    <div slot="footer" *ngIf="totalRecords > 0">
      <app-pagination
        [pagination]="getPaginationInfo()"
        (pageChange)="goToPage({target: {value: $event}})"
        (previousPage)="previousPage()"
        (nextPage)="nextPage()">
      </app-pagination>
    </div>
  </app-content-card>
</div>

<!-- ==================== MODAL DE CRIAÇÃO/EDIÇÃO ==================== -->
<app-generic-modal
  [(visible)]="showCreateModal"
  [title]="modalTitle"
  [actions]="modalActions"
  [dialogStyle]="{ width: '90vw', maxWidth: '700px' }">
  
  <form [formGroup]="adopterForm" class="adopter-create-form">
    
    <!-- ==================== SEÇÃO: INFORMAÇÕES PESSOAIS ==================== -->
    <div class="form-section">
      <h3>
        <i class="pi pi-user"></i>
        Informações Pessoais
      </h3>
      
      <div class="form-grid">
        <!-- Nome -->
        <div class="form-field">
          <label for="firstName">Nome *</label>
          <input 
            pInputText 
            id="firstName" 
            formControlName="firstName"
            placeholder="Digite o primeiro nome"
            [class.ng-invalid]="isFieldInvalid('firstName')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('firstName')">
            {{ getFieldError('firstName') }}
          </small>
        </div>

        <!-- Sobrenome -->
        <div class="form-field">
          <label for="lastName">Sobrenome *</label>
          <input 
            pInputText 
            id="lastName" 
            formControlName="lastName"
            placeholder="Digite o sobrenome"
            [class.ng-invalid]="isFieldInvalid('lastName')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('lastName')">
            {{ getFieldError('lastName') }}
          </small>
        </div>

        <!-- Data de Nascimento -->
        <div class="form-field">
          <label for="birthDate">Data de Nascimento</label>
          <input 
            type="date" 
            id="birthDate" 
            formControlName="birthDate"
            [class.ng-invalid]="isFieldInvalid('birthDate')"
            class="form-input date-input">
          <small class="error-message" *ngIf="getFieldError('birthDate')">
            {{ getFieldError('birthDate') }}
          </small>
        </div>

        <!-- CPF -->
        <div class="form-field">
          <label for="cpf">CPF *</label>
          <p-inputMask 
            id="cpf"
            formControlName="cpf"
            mask="999.999.999-99"
            placeholder="000.000.000-00"
            [class.ng-invalid]="isFieldInvalid('cpf')"
            class="form-input">
          </p-inputMask>
          <small class="error-message" *ngIf="getFieldError('cpf')">
            {{ getFieldError('cpf') }}
          </small>
        </div>
      </div>
    </div>

    <!-- ==================== SEÇÃO: INFORMAÇÕES DE CONTATO ==================== -->
    <div class="form-section">
      <h3>
        <i class="pi pi-address-book"></i>
        Informações de Contato
      </h3>
      
      <div class="form-grid">
        <!-- Telefone -->
        <div class="form-field">
          <label for="phone">Telefone *</label>
          <p-inputMask 
            id="phone"
            formControlName="phone"
            mask="(99) 99999-9999"
            placeholder="(00) 00000-0000"
            [class.ng-invalid]="isFieldInvalid('phone')"
            class="form-input">
          </p-inputMask>
          <small class="error-message" *ngIf="getFieldError('phone')">
            {{ getFieldError('phone') }}
          </small>
        </div>

        <!-- Email -->
        <div class="form-field">
          <label for="email">Email</label>
          <input 
            pInputText 
            id="email" 
            type="email"
            formControlName="email"
            placeholder="exemplo@email.com"
            [class.ng-invalid]="isFieldInvalid('email')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('email')">
            {{ getFieldError('email') }}
          </small>
        </div>

        <!-- Instagram -->
        <div class="form-field">
          <label for="instagram">Instagram</label>
          <input 
            pInputText 
            id="instagram" 
            type="text"
            formControlName="instagram"
            placeholder="@usuario ou usuario"
            class="form-input">
        </div>

        <!-- Data de Cadastro -->
        <div class="form-field">
          <label for="registrationDate">Data de Cadastro *</label>
          <input 
            type="date" 
            id="registrationDate" 
            formControlName="registrationDate"
            [class.ng-invalid]="isFieldInvalid('registrationDate')"
            class="form-input date-input">
          <small class="error-message" *ngIf="getFieldError('registrationDate')">
            {{ getFieldError('registrationDate') }}
          </small>
        </div>
      </div>
    </div>

    <!-- Endereço -->
    <div class="form-section">
      <h3>
        <i class="fas fa-map-marker-alt"></i>
        Endereço
      </h3>
      
      <div class="form-grid">
        <!-- Rua -->
        <div class="form-field form-field-full">
          <label for="street">Rua *</label>
          <input 
            pInputText 
            id="street" 
            formControlName="street"
            placeholder="Nome da rua/logradouro"
            [class.ng-invalid]="isFieldInvalid('street')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('street')">
            {{ getFieldError('street') }}
          </small>
        </div>

        <!-- Número -->
        <div class="form-field">
          <label for="number">Número *</label>
          <input 
            pInputText 
            id="number" 
            formControlName="number"
            placeholder="Nº"
            [class.ng-invalid]="isFieldInvalid('number')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('number')">
            {{ getFieldError('number') }}
          </small>
        </div>

        <!-- Complemento -->
        <div class="form-field">
          <label for="complement">Complemento</label>
          <input 
            pInputText 
            id="complement" 
            formControlName="complement"
            placeholder="Apto, Bloco, etc."
            class="form-input">
        </div>

        <!-- Bairro -->
        <div class="form-field">
          <label for="neighborhood">Bairro *</label>
          <input 
            pInputText 
            id="neighborhood" 
            formControlName="neighborhood"
            placeholder="Nome do bairro"
            [class.ng-invalid]="isFieldInvalid('neighborhood')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('neighborhood')">
            {{ getFieldError('neighborhood') }}
          </small>
        </div>

        <!-- Cidade -->
        <div class="form-field">
          <label for="city">Cidade *</label>
          <input 
            pInputText 
            id="city" 
            formControlName="city"
            placeholder="Nome da cidade"
            [class.ng-invalid]="isFieldInvalid('city')"
            class="form-input">
          <small class="error-message" *ngIf="getFieldError('city')">
            {{ getFieldError('city') }}
          </small>
        </div>

        <!-- Estado -->
        <div class="form-field">
          <label for="state">Estado *</label>
          <input 
            pInputText 
            id="state" 
            formControlName="state"
            placeholder="UF"
            maxlength="2"
            [class.ng-invalid]="isFieldInvalid('state')"
            class="form-input"
            style="text-transform: uppercase;">
          <small class="error-message" *ngIf="getFieldError('state')">
            {{ getFieldError('state') }}
          </small>
        </div>

        <!-- CEP -->
        <div class="form-field">
          <label for="zipCode">CEP *</label>
          <p-inputMask 
            id="zipCode"
            formControlName="zipCode"
            mask="99999-999"
            placeholder="00000-000"
            [class.ng-invalid]="isFieldInvalid('zipCode')"
            class="form-input">
          </p-inputMask>
          <small class="error-message" *ngIf="getFieldError('zipCode')">
            {{ getFieldError('zipCode') }}
          </small>
        </div>
      </div>
    </div>
  </form>
</app-generic-modal>

<!-- ==================== MODAL DE CONFIRMAÇÃO DE EXCLUSÃO ==================== -->
<app-confirmation-modal
  [(visible)]="confirmationModalVisible"
  [config]="confirmationConfig"
  (confirmed)="onConfirmationConfirmed()"
  (cancelled)="onConfirmationCancelled()">
</app-confirmation-modal>

<!-- ==================== MODAL DE DETALHES DO ADOTANTE ==================== -->
<app-adopter-details-modal
  [(visible)]="showDetailsModal"
  [adopter]="selectedAdopter">
</app-adopter-details-modal>
